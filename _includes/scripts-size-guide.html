<script type="text/javascript">
    $(document).ready(function(){

        const lowestMeasurementCentimetres = 17;
        const highestMeasurementCentimetres = 49;
        const lowestMeasurementInches = 7;
        const highestMeasurementInches = 19;
        const centimetresKeyword = "Centimetres";
        const inchesKeyword = "Inches";
        const centimetresRegex = new RegExp(centimetresKeyword);
        const inchesRegex = new RegExp(inchesKeyword);
        const centimetresToInchesConversionAmount = 2.54;
        const sizeXtraSmallCentimetresFirstHole = 17;
        const sizeXtraSmallCentimetresLastHole = 27;
        const sizeSmallCentimetresFirstHole = 23;
        const sizeSmallCentimetresLastHole = 33;
        const sizeMediumCentimetresFirstHole = 29;
        const sizeMediumCentimetresLastHole = 41;
        const sizeLargeCentimetresFirstHole = 37;
        const sizeLargeCentimetresLastHole = 49;
        const sizeXtraSmall = "Size Xtra Small";
        const sizeSmall = "Size Small";
        const sizeMedium = "Size Medium";
        const sizeLarge = "Size Large";
        const measurementTypeMessagePrefix = "You're measuring using ";
        const recommendedProductSizeMessagePrefix = "We recommended you purchase ";
        const errorMessage = "Sorry, we could not determine your size.";

        window.onload = generateMeasurementSelectList(
            lowestMeasurementCentimetres, 
            highestMeasurementCentimetres, 
            centimetresKeyword);

        $("[name=measurementTypeRadioButton]").click(function()  {
            var chosenMeasurementValue = $(this).val();
            
            changeMeasurementTypeAfterRadioButtonClick(chosenMeasurementValue);

            hideProductSizeResults();
        });

        function changeMeasurementTypeAfterRadioButtonClick(chosenMeasurementValue)
        {
            const measurementTypeLabel = measurementTypeMessagePrefix + chosenMeasurementValue;

            $("#measurementTypeLabel").text(measurementTypeLabel);

            removeAllSelectListOptions(document.getElementById("measurementValueSelectList"));

            if(chosenMeasurementValue.indexOf(centimetresKeyword) !== -1)
            {
                generateMeasurementSelectList(
                    lowestMeasurementCentimetres, 
                    highestMeasurementCentimetres, 
                    centimetresKeyword);
            }
            else if(chosenMeasurementValue.indexOf(inchesKeyword) !== -1)
            {
                generateMeasurementSelectList(
                    lowestMeasurementInches, 
                    highestMeasurementInches, 
                    inchesKeyword);
            }
        }

        function removeAllSelectListOptions(measurementSelectList) {
            var measurementSelectListLength = measurementSelectList.options.length - 1;
            
            for(var i = measurementSelectListLength; i >= 0; i--) {
                measurementSelectList.remove(i);
            }
        }

        $('#measurementValueSelectList').change(function() {
            var currentlySelectedMeasurementValue = $('#measurementValueSelectList option:selected').val();

            getProductSizeAfterMeasurementValueSelected(currentlySelectedMeasurementValue);
        });

        function getProductSizeAfterMeasurementValueSelected(currentlySelectedMeasurementValue)
        {
            // console.log("Chosen " + currentlySelectedMeasurementValue);

            var correctProductSize = determineCorrectProductSizeToPurchase(currentlySelectedMeasurementValue);

            var correctProductSizeMessage = recommendedProductSizeMessagePrefix + correctProductSize;

            console.log(correctProductSizeMessage);

            $("#correctProductSizeLabel").text(correctProductSizeMessage);

            showProductSizeResults();
        }

        function generateMeasurementSelectList(lowestMeasurement, highestMeasurement, measurementType)
        {
            const measurementIncreaseByQuarter = 0.25;
            const measurementIncreaseByHalf = 0.5;
            const measurementIncreaseByThreeQuarters = 0.75;

            var measurementValueSelectList = document.getElementById("measurementValueSelectList");

            for (i = lowestMeasurement; i <= highestMeasurement; i++) 
            { 
                const currentMeasurementValue = i;
                var currentMeasurementValueIncreasedByQuarter = currentMeasurementValue + measurementIncreaseByQuarter;
                var currentMeasurementValueIncreasedByHalf = currentMeasurementValue + measurementIncreaseByHalf;
                var currentMeasurementValueIncreasedByThreeQuarters = currentMeasurementValue + measurementIncreaseByThreeQuarters;

                measurementValueSelectList.appendChild(
                    createSelectListOption(
                        currentMeasurementValue, 
                        measurementType));

                if(measurementType.indexOf(centimetresKeyword) !== -1)
                {
                    measurementValueSelectList.appendChild(
                    createSelectListOption(
                        currentMeasurementValueIncreasedByHalf, 
                        measurementType));
                }
                else if(measurementType.indexOf(inchesKeyword) !== -1)
                {
                    measurementValueSelectList.appendChild(
                    createSelectListOption(
                        currentMeasurementValueIncreasedByQuarter, 
                        measurementType));

                    measurementValueSelectList.appendChild(
                        createSelectListOption(
                            currentMeasurementValueIncreasedByHalf, 
                            measurementType));

                    measurementValueSelectList.appendChild(
                        createSelectListOption(
                            currentMeasurementValueIncreasedByThreeQuarters, 
                            measurementType));
                }
            }
        }

        function createSelectListOption(inputMeasurementValue, measurementType)
        {
            const generatedMeasurementValue = inputMeasurementValue + " " + measurementType;
            
            var selectListOption = document.createElement("option");
            selectListOption.value = generatedMeasurementValue;
            selectListOption.text = generatedMeasurementValue;

            return selectListOption
        }

        function stripInputMeasurementValue(inputMeasurementValue)
        {
            if(inputMeasurementValue.indexOf(centimetresKeyword) !== -1)
            {
                // console.log("Contains Cm");
                var strippedInputMeasurementValueCentimetres = inputMeasurementValue.replace(centimetresRegex,"");

                return [strippedInputMeasurementValueCentimetres, centimetresKeyword];
            }
            else if(inputMeasurementValue.indexOf(inchesKeyword) !== -1)
            {
                // console.log("Contains In");
                var strippedInputMeasurementValueInches = inputMeasurementValue.replace(inchesRegex,"");

                return [strippedInputMeasurementValueInches, inchesKeyword];
            }
        }

        function determineCorrectProductSizeToPurchase(inputMeasurementValue)
        {
            var strippedMeasurementResults = stripInputMeasurementValue(inputMeasurementValue);
            const strippedInputMeasurementValue = strippedMeasurementResults[0];
            const measurementValueType = strippedMeasurementResults[1];

            if(measurementValueType == centimetresKeyword)
            {
                return lookupCentimetresMeasurement(strippedInputMeasurementValue);
            }
            else if(measurementValueType == inchesKeyword)
            {
                var convertedInchesMeasurementToCentimetres = convertFromInchesToCentimetres(strippedInputMeasurementValue);

                return lookupCentimetresMeasurement(convertedInchesMeasurementToCentimetres);
            }
        }

        function convertFromInchesToCentimetres(inputInchesValue)
        {
            return inputInchesValue * centimetresToInchesConversionAmount;
        }

        // function convertFromCentimetresToInches(inputCentimetresValue)
        // {
        //     return inputCentimetresValue / centimetresToInchesConversionAmount;
        // }

        function lookupCentimetresMeasurement(inputCentimetreValue)
        {
            var sizeResults = new Array();

            if (inputCentimetreValue >= sizeXtraSmallCentimetresFirstHole && 
                inputCentimetreValue <= sizeXtraSmallCentimetresLastHole) {
                    sizeResults.push(sizeXtraSmall);
            }

            if (inputCentimetreValue >= sizeSmallCentimetresFirstHole && 
                    inputCentimetreValue <= sizeSmallCentimetresLastHole) {
                        sizeResults.push(sizeSmall);
            }
            
            if (inputCentimetreValue >= sizeMediumCentimetresFirstHole && 
                    inputCentimetreValue <= sizeMediumCentimetresLastHole) {
                        sizeResults.push(sizeMedium);
            }
            
            if (inputCentimetreValue >= sizeLargeCentimetresFirstHole 
                    && inputCentimetreValue <= sizeLargeCentimetresLastHole) {
                        sizeResults.push(sizeLarge);
            }
            
            if(sizeResults.length > 0)
            {
                if(sizeResults.length == 1)
                {
                    // console.log("1 result");

                    return sizeResults[0];
                }
                else if(sizeResults.length >= 2)
                {
                    // console.log("2 or more results");

                    var sizeResultMessage = sizeResults.join(" and ");

                    return sizeResultMessage;
                }
            }
            else
            {
                return errorMessage;
            }
        }

        // function lookupInchesMeasurement(inputInchesValue)
        // {
        //     if (inputInchesValue >= 1 && inputInchesValue <= 3) {
        //         return sizeXtraSmall;
        //     }
        //     else if (inputInchesValue >= 4 && inputInchesValue <= 6) {
        //         return sizeSmall;
        //     }
        //     else if (inputInchesValue >= 7 && inputInchesValue <= 9) {
        //         return sizeMedium;
        //     }
        //     else if (inputInchesValue >= 10 && inputInchesValue <= 12) {
        //         return sizeLarge;
        //     }
        // }

        function showProductSizeResults()
        {
            $("#productSizeResults").show();
        }

        function hideProductSizeResults()
        {
            $("#productSizeResults").hide();
        }
    });
</script>